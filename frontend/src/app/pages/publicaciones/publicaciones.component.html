<div class="publicaciones-container">
    <div class="top-bar">
        <div class="player-wrapper">
            <div class="player-card">
                <div class="player-info">
                    <div class="player-info-left">
                        <div class="player-disc">
                            <svg viewBox="0 0 128 128" class="disc-svg">
                                <rect width="128" height="128" fill="black"></rect>
                                <circle cx="20" cy="20" r="2" fill="white"></circle>
                                <circle cx="40" cy="30" r="2" fill="white"></circle>
                                <circle cx="60" cy="10" r="2" fill="white"></circle>
                                <circle cx="80" cy="40" r="2" fill="white"></circle>
                                <circle cx="100" cy="20" r="2" fill="white"></circle>
                                <circle cx="120" cy="50" r="2" fill="white"></circle>
                                <circle cx="90" cy="30" r="10" fill="white" fill-opacity="0.5"></circle>
                                <circle cx="90" cy="30" r="8" fill="white"></circle>
                                <path d="M0 128 Q32 64 64 128 T128 128" fill="purple" stroke="black" stroke-width="1"></path>
                                <path d="M0 128 Q32 48 64 128 T128 128" fill="mediumpurple" stroke="black" stroke-width="1"></path>
                                <path d="M0 128 Q32 32 64 128 T128 128" fill="rebeccapurple" stroke="black" stroke-width="1"></path>
                                <path d="M0 128 Q16 64 32 128 T64 128" fill="purple" stroke="black" stroke-width="1"></path>
                                <path d="M64 128 Q80 64 96 128 T128 128" fill="mediumpurple" stroke="black" stroke-width="1"></path>
                            </svg>
                        <div class="disc-center"></div>
                    </div>

                </div>

                <div class="track-info">
                    <p class="track-title">{{ songs[currentSongIndex].title }}</p>
                    <p class="track-artist">{{ songs[currentSongIndex].artist }}</p>
                </div>
                </div>

                <div class="progress-bar">
                    <span>{{ currentTime }}</span>
                    <input
                        type="range"
                        [value]="progress"
                        (input)="seekTo($event)"
                        min="0"
                        max="100"
                    />
                    <span>{{ duration }}</span>
                </div>

                <div class="controls">
                <!-- Botón Retroceder -->
                <button class="btn skip-back" (click)="prevSong()" aria-label="Retroceder">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="19 20 9 12 19 4 19 20"></polygon>
                    <line x1="5" y1="4" x2="5" y2="20"></line>
                    </svg>
                </button>

                <!-- Botón Play/Pause -->
                <button class="btn play" (click)="togglePlay()" aria-label="Play/Pause">
                    <!-- Ícono PLAY -->
                    <svg
                    [hidden]="isPlaying"
                    viewBox="0 0 24 24"
                    width="24"
                    height="24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    >
                    <polygon points="6 4 20 12 6 20 6 4"></polygon>
                    </svg>

                    <!-- Ícono PAUSE -->
                    <svg
                    [hidden]="!isPlaying"
                    viewBox="0 0 24 24"
                    width="24"
                    height="24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    >
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                </button>

                <!-- Botón Avanzar -->
                <button class="btn skip-forward" (click)="nextSong()" aria-label="Avanzar">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="5 4 15 12 5 20 5 4"></polygon>
                    <line x1="19" y1="4" x2="19" y2="20"></line>
                    </svg>
                </button>
                </div>

                <!-- AUDIO OCULTO -->
                <audio #audioPlayer hidden></audio>
            </div>
        </div>


        <div class="filtros-contenedor">
            <div class="filtro-usuario">
                <select [formControl]="usuarioControl" id="filtroUsuario">
                <option [value]="null">Filtrar Usuarios</option>
                @for (usuario of usuarios; track usuario._id) {
                    <option [value]="usuario._id">{{ usuario.nombre }}</option>
                }
                </select>
            </div>

            <div class="filtros">
                <button (click)="cambiarOrden('fecha')" [class.activo]="ordenarPor === 'fecha'">Ordenar por fecha</button>
                <button (click)="cambiarOrden('like')" [class.activo]="ordenarPor === 'like'">Ordenar por Likes</button>
            </div>
        </div>
    </div>


    <div class="publicaciones-listado">
        @for (pub of publicaciones; track pub._id) {
            <a [routerLink]="['/publicacion', pub._id]" class="card-link">
                <app-card
                    [id]="pub._id"
                    [imagen]="pub.imagen"
                    [pieDeFoto]="pub.pieDeFoto"
                    [fecha]="pub.fecha"
                    [usuario]="pub.usuarioId.nombre"
                    [like]="pub.like"
                    [yaDioLike]="pub.yaDioLike"
                    [esAdmin]="usuarioLogueado?.rol === 'admin'"
                />
            </a>
        }
    </div>

    <div class="paginacion">
    <button class="btn-estilo" (click)="anteriorPagina()" [disabled]="offset === 0">Anterior</button>
    <button class="btn-estilo" (click)="siguientePagina()" [disabled]="!hayMasPublicaciones">Siguiente</button>
    </div>

</div>

